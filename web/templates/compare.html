<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ document_title }} - Comparison</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/compare.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/correction_modal.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/document_ai_assistant.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
    <header class="toolbar">
        <div class="toolbar-left">
            <h1>üìÑ Document Comparison</h1>
            <span class="filename">{{ pdf_filename }}</span>
        </div>
        <div class="toolbar-center">
            <button id="prev-page" class="btn" title="Previous Page (Left Arrow)">‚Üê Prev</button>
            <span class="page-info">
                <span>Page </span>
                <input type="number" id="page-num" value="1" min="1" title="Enter page number" />
                <span> / </span>
                <span id="page-count">--</span>
            </span>
            <button id="next-page" class="btn" title="Next Page (Right Arrow)">Next ‚Üí</button>
        </div>
        <div class="toolbar-right">
            <label class="sync-label" title="Toggle scroll synchronization">
                <input type="checkbox" id="sync-scroll" checked />
                <span>Sync Scroll</span>
            </label>
            <button id="zoom-out" class="btn" title="Zoom Out">‚àí</button>
            <span id="zoom-level" class="zoom-display">100%</span>
            <button id="zoom-in" class="btn" title="Zoom In">+</button>
        </div>
    </header>

    <div class="comparison-container">
        <!-- PDF Panel -->
        <div class="panel pdf-panel">
            <div class="panel-header">
                <h2>Original PDF</h2>
            </div>
            <div class="panel-content" id="pdf-content">
                <div id="pdf-loading" class="loading">Loading PDF...</div>
                <canvas id="pdf-canvas" style="display: none;"></canvas>
            </div>
        </div>

        <!-- Resizable Divider -->
        <div class="divider" title="Drag to resize panels"></div>

        <!-- HTML Panel -->
        <div class="panel html-panel">
            <div class="panel-header">
                <h2>Processed HTML</h2>
            </div>
            <div class="panel-content" id="html-content">
                <div class="loading">Loading HTML content...</div>
            </div>
        </div>
    </div>

    <!-- Correction Modal -->
    <div id="correction-modal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Correct Entity <span id="modal-entity-id"></span></h2>
                <button class="close-btn">&times;</button>
            </div>

            <div class="modal-body">
                <!-- Entity Info -->
                <div class="entity-info">
                    <span class="info-badge">Type: <strong id="modal-entity-type"></strong></span>
                    <span class="info-badge">Page: <strong id="modal-entity-page"></strong></span>
                </div>

                <!-- Original Content (Read-only) -->
                <div class="content-section">
                    <label>Original Content:</label>
                    <pre id="original-content" class="content-display"></pre>
                </div>

                <!-- Correction Method Tabs -->
                <div class="correction-tabs">
                    <button class="tab-btn active" data-tab="manual">Manual Edit</button>
                    <button class="tab-btn" data-tab="ai">AI-Assisted</button>
                </div>

                <!-- Manual Edit Tab -->
                <div id="manual-tab" class="tab-content active">
                    <label>Corrected Content:</label>
                    <textarea id="manual-edit" class="edit-textarea" rows="15"></textarea>
                    <label>Reason for Correction:</label>
                    <input type="text" id="manual-reason" placeholder="e.g., Fixed unit conversion error" />
                </div>

                <!-- AI-Assisted Tab -->
                <div id="ai-tab" class="tab-content" style="display: none;">
                    <label>Describe the Issue:</label>
                    <textarea id="ai-prompt" class="prompt-textarea" rows="5"
                              placeholder="e.g., The responsible party should be 'Chief Engineer' not 'Master'"></textarea>
                    <button id="generate-correction-btn" class="btn btn-primary">
                        Generate Correction
                    </button>

                    <!-- AI Result (hidden until generated) -->
                    <div id="ai-result" style="display: none;">
                        <label>AI-Generated Correction:</label>
                        <pre id="ai-corrected-content" class="content-display"></pre>
                        <label>Review and Adjust:</label>
                        <textarea id="ai-edit" class="edit-textarea" rows="15"></textarea>
                    </div>
                </div>

                <!-- Preview Section -->
                <div id="preview-section" style="display: none;">
                    <label>Preview:</label>
                    <div id="preview-content" class="preview-display"></div>
                </div>
            </div>

            <div class="modal-footer">
                <button id="cancel-btn" class="btn btn-secondary">Cancel</button>
                <button id="save-correction-btn" class="btn btn-success">Save Correction</button>
            </div>

            <!-- Loading Overlay -->
            <div id="modal-loading" class="loading-overlay" style="display: none;">
                <div class="spinner"></div>
                <p>Processing...</p>
            </div>
        </div>
    </div>

    <!-- Pass manifest data to JavaScript -->
    <script>
        window.MANIFEST = {{ manifest | tojson }};
    </script>
    <script src="{{ url_for('static', filename='js/compare.js') }}"></script>
    <script src="{{ url_for('static', filename='js/correction_modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/document_ai_assistant.js') }}"></script>
</body>
</html>
